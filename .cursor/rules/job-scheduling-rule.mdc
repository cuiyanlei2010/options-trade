---
description: 
globs: 
alwaysApply: true
---
# 任务调度规范

## 定时任务设计

系统中的任务调度相关代码主要在 [api/src/main/java/me/dingtou/options/job](mdc:api/src/main/java/me/dingtou/options/job) 目录下定义：

1. 任务设计原则：
   - 每个任务应该有单一职责
   - 任务执行应该是幂等的，避免重复执行导致数据异常
   - 关键任务应有重试机制和失败处理策略
   - 长时间运行的任务应考虑超时控制

2. 任务配置：
   - 使用Spring的@Scheduled注解配置定时任务
   - cron表达式放在配置文件中，方便调整
   - 提供手动触发任务的接口
   - 考虑集群环境下的任务重复执行问题

3. 日志记录：
   - 记录任务开始和结束时间
   - 记录关键处理步骤和数据变更
   - 异常情况详细记录错误信息
   - 可通过日志追踪任务执行全过程

## 异步处理

1. 异步任务：
   - 使用Spring的@Async注解实现异步处理
   - 配置合适的线程池参数
   - 长时间运行的异步任务需要考虑监控和中断机制

2. 消息队列：
   - 对于复杂的异步处理流程考虑使用消息队列
   - 实现生产者-消费者模式，增强系统可靠性
   - 考虑消息的持久化和重复消费问题
